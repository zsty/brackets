define(function(require,exports,module){"use strict";var _=brackets.getModule("thirdparty/lodash"),PreferencesManager=brackets.getModule("preferences/PreferencesManager"),Strings=brackets.getModule("strings"),Dialogs=brackets.getModule("widgets/Dialogs"),ExtensionUtils=brackets.getModule("utils/ExtensionUtils"),HealthDataPreviewDialog=require("text!htmlContent/healthdata-preview-dialog.html"),HealthDataManager=require("HealthDataManager");var prefs=PreferencesManager.getExtensionPrefs("healthData");ExtensionUtils.loadStyleSheet(module,"styles.css");function previewHealthData(){var result=new $.Deferred;HealthDataManager.getHealthData().done(function(healthDataObject){var content=JSON.stringify(healthDataObject,null,4);content=_.escape(content);content=content.replace(/ /g,"&nbsp;");content=content.replace(/(?:\r\n|\r|\n)/g,"<br />");var hdPref=prefs.get("healthDataTracking"),newHDPref=hdPref,template=Mustache.render(HealthDataPreviewDialog,{Strings:Strings,content:content,hdPref:hdPref}),$template=$(template);Dialogs.showModalDialogUsingTemplate($template).done(function(id){if(id==="save"){newHDPref=$template.find("[data-target]:checkbox").is(":checked");if(hdPref!==newHDPref){prefs.set("healthDataTracking",newHDPref)}}});return result.resolve()});return result.promise()}exports.previewHealthData=previewHealthData});